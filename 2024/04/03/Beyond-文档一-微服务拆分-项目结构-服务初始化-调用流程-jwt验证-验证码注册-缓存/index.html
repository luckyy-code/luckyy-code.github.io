
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Beyond 文档一 微服务拆分&amp;&amp;项目结构 &amp;&amp; 服务初始化 &amp;&amp; 调用流程 &amp;&amp; jwt验证 &amp;&amp; 验证码注册 | luckyy-code</title>
    <meta name="author" content="段雨超" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <link rel="icon" href="/images/avatar.jpg" />


    <link rel="preconnect" href="https://s4.zstatic.net" />
<script src="https://s4.zstatic.net/ajax/libs/vue/3.3.7/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
<link rel="preconnect" href="https://fonts.loli.net" />
<link rel="preconnect" href="https://gstatic.loli.net" crossorigin />
<link rel="stylesheet" href="https://fonts.loli.net/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap" />
<script> const mixins = {}; </script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>


<script src="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
<link
    rel="stylesheet"
    href="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>



<script src="/js/lib/preview.js"></script>









<link rel="stylesheet" href="/css/main.css" />

<meta name="generator" content="Hexo 6.3.0"></head>
<body>
    <div id="layout">
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>加载过慢请开启缓存 浏览器默认开启</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
        </transition>
        <div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <nav id="desktop-menu">
        <a class="title" href="/">
            <span>LUCKYY-CODE</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </nav>
    <nav id="mobile-menu">
        <div class="title" @click="showMenuItems = !showMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;LUCKYY-CODE</span>
        </div>
        <transition name="slide">
            <div class="items" v-show="showMenuItems">
                
                <a href="/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-house fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                    </div>
                </a>
                
                <a href="/about">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-id-card fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                    </div>
                </a>
                
                <a href="/archives">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-box-archive fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                    </div>
                </a>
                
                <a href="/categories">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-bookmark fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                    </div>
                </a>
                
                <a href="/tags">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-tags fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                    </div>
                </a>
                
            </div>
        </transition>
    </nav>
</div>
<transition name="fade">
    <div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div>
</transition>

        <div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'">
            <div class="article">
    <div>
        <h1>Beyond 文档一 微服务拆分&amp;&amp;项目结构 &amp;&amp; 服务初始化 &amp;&amp; 调用流程 &amp;&amp; jwt验证 &amp;&amp; 验证码注册</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/4/3
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <i class="fa-solid fa-tags fa-fw"></i>
            </span>
            
            
            <span class="tag">
                
                <a href="/tags/Beyond/" style="color: #00a596">Beyond</a>
            </span>
            
            <span class="tag">
                
                <a href="/tags/golang/" style="color: #03a9f4">golang</a>
            </span>
            
            <span class="tag">
                
                <a href="/tags/%E6%96%87%E6%A1%A3/" style="color: #00a596">文档</a>
            </span>
            
        </span>
        
    </div>
    
    <div class="content" v-pre>
        <h3 id="Beyond-文档一-微服务拆分-项目结构-服务初始化-调用流程-jwt验证-验证码注册"><a href="#Beyond-文档一-微服务拆分-项目结构-服务初始化-调用流程-jwt验证-验证码注册" class="headerlink" title="Beyond 文档一 微服务拆分&amp;&amp;项目结构 &amp;&amp; 服务初始化 &amp;&amp; 调用流程 &amp;&amp; jwt验证 &amp;&amp; 验证码注册"></a>Beyond 文档一 微服务拆分&amp;&amp;项目结构 &amp;&amp; 服务初始化 &amp;&amp; 调用流程 &amp;&amp; jwt验证 &amp;&amp; 验证码注册</h3><span id="more"></span>

<h2 id="服务拆分"><a href="#服务拆分" class="headerlink" title="服务拆分"></a>服务拆分</h2><p>微服务倡导将单体服务划分成一组小服务，服务之间采用轻量级的通信机制相互配合、相互协调，为用户提供最终价值。每个服务运行在独立的进程中，围绕具体业务进行构建并且能够独立部署到生产环境中。</p>
<h3 id="服务划分"><a href="#服务划分" class="headerlink" title="服务划分"></a>服务划分</h3><p>按照所在的职能部门，独立业务功能进行划分，比如评论服务，用户服务，购物车服务等就可以独立的划分为一个微服务。</p>
<p>文章(article)<strong>独立为一个微服务，</strong>用户(user)<strong>可以独立为一个微服务，</strong>点赞(like)<strong>独立为一个微服务，</strong>关注(follow)独立为一个微服务</p>
<table>
<thead>
<tr>
<th align="center">用户服务</th>
<th>关注服务</th>
</tr>
</thead>
<tbody><tr>
<td align="center">文章服务</td>
<td>点赞服务</td>
</tr>
</tbody></table>
<h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><pre><code class="shell">[feng@myarch beyond]$ tree -L 1 
.
├── application
├── db
├── mysql
├── pkg
└── README.md

[feng@myarch beyond]$ tree -L 2
.
├── application
│   ├── applet
│   ├── article
│   ├── follow
│   ├── like
│   └── user
├── db
├── pkg
│   ├── encrypt
│   ├── jwt
│   ├── orm
│   ├── util
│   └── xcode
└── README.md

</code></pre>
<h3 id="生成api服务"><a href="#生成api服务" class="headerlink" title="生成api服务"></a>生成api服务</h3><pre><code class="shell">cd ~/beyond/application/applet
mkdir pb;cd pb
goctl api go -api *.api -dir ../ --style=goZero
</code></pre>
<pre><code class="shell">[feng@myarch application]$ tree -L 3
.
├── applet
│   ├── applet.go
│   ├── etc
│   │   └── applet-api.yaml
│   ├── internal
│   │   ├── config
│   │   ├── handler
│   │   ├── logic
│   │   ├── svc
│   │   └── types
│   └── pb
│       └── applet.api
├── article
├── follow
├── like
└── user        

├── db
├── pkg
│   ├── encrypt
│   ├── jwt
│   ├── orm
│   ├── util
│   └── xcode
└── README.md
</code></pre>
<h3 id="生成rpc项目"><a href="#生成rpc项目" class="headerlink" title="生成rpc项目"></a>生成rpc项目</h3><pre><code class="shell">cd ~/beyond/application/user
mkdir pb;cd pb
goctl rpc protoc *.proto --go_out=../ --go-grpc_out=../ --zrpc_out=../ --style=goZero
</code></pre>
<pre><code class="shell">[feng@myarch user]$ tree ./rpc/ 
./rpc/
├── etc
│   └── user.yaml
├── internal
│   ├── config
│   │   └── config.go
│   ├── logic
│   │   ├── findByIdLogic.go
│   │   ├── findByMobileLogic.go
│   │   ├── registerLogic.go
│   │   └── sendSmsLogic.go
│   ├── server
│   │   └── userServer.go
│   └── svc
│       └── serviceContext.go
├── pb
│   ├── user_grpc.pb.go
│   ├── user.pb.go
│   └── user.proto
├── user
│   └── user.go
└── user.go
</code></pre>
<h3 id="生成model"><a href="#生成model" class="headerlink" title="生成model"></a>生成model</h3><p>首先创建表</p>
<pre><code class="sql">create database beyond_user;
use beyond_user;

CREATE TABLE `user` (
                        `id` bigint(20) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT &#39;主键ID&#39;,
                        `username` varchar(32) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;用户名&#39;,
                        `avatar` varchar(256) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;头像&#39;,
                        `mobile` varchar(128) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;手机号&#39;,
                        `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#39;创建时间&#39;,
                        `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT &#39;最后修改时间&#39;,
                        PRIMARY KEY (`id`),
                        KEY `ix_update_time` (`update_time`),
                        UNIQUE KEY `uk_mobile` (`mobile`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin COMMENT=&#39;用户表&#39;;
</code></pre>
<p>生成model命令</p>
<pre><code class="shell">cd /beyond/application/user/rpc
goctl model mysql datasource --dir ./internal/model --table user --cache true --url &quot;root&quot; 123456@tcp(127.0.0.1:3306)/beyond_user&quot;
</code></pre>
<pre><code class="Shell">tree ./internal/model

./internal/model
├── usermodel.go
├── usermodel_gen.go
└── vars.go
</code></pre>
<h3 id="启动rpc服务和api服务"><a href="#启动rpc服务和api服务" class="headerlink" title="启动rpc服务和api服务"></a>启动rpc服务和api服务</h3><p>准备工作启动mysql 、redis、etcd。</p>
<p>再启动user.go和applet.go</p>
<p>查看user-rpc是否在etcd中注册</p>
<pre><code class="shell">./etcdctl get --prefix user.rpc
user.rpc/7587877843151607557
192.168.123.58:8080
</code></pre>
<h3 id="短信验证"><a href="#短信验证" class="headerlink" title="短信验证"></a>短信验证</h3><pre><code class="shell"> get biz#activation#18729908763  #查看验证码
&quot;210917&quot;
get biz#verification#count#18729908763 #查看验证码次数每天最多只能验证10次
&quot;1&quot;
</code></pre>
<h3 id="注册-登录-查看用户详情功能"><a href="#注册-登录-查看用户详情功能" class="headerlink" title="注册&amp;&amp;登录&amp;&amp;查看用户详情功能"></a>注册&amp;&amp;登录&amp;&amp;查看用户详情功能</h3><p><img src="https://telegraph-image-d8w.pages.dev/file/3f91624a27deeba6bd71a.png"></p>
<p><img src="https://telegraph-image-d8w.pages.dev/file/89e4b71bf5c353ab9f44f.png"></p>
<p><img src="https://telegraph-image-d8w.pages.dev/file/6594f04f856ffa6e9d1af.png"></p>
<p>查看数据库</p>
<p><img src="https://telegraph-image-d8w.pages.dev/file/c461274d25564c61d19c6.png"></p>

    </div>
    
    
    
    
    
    
    
</div>

            <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2024 luckyy-code
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;段雨超
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

        </div>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>

    <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas>
    <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script>
    <script type="text/javascript" src="/js/fireworks.js"></script>

    <script src="/js/main.js"></script>
    <script src="/js/lib/fireworks.js>"></script>

    
    




    
</body>
</html>
