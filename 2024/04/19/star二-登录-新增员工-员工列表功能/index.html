
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>star二 登录&amp;新增员工&amp;员工列表功能 | luckyy-code</title>
    <meta name="author" content="段雨超" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <link rel="icon" href="/images/avatar.jpg" />


    <link rel="preconnect" href="https://s4.zstatic.net" />
<script src="https://s4.zstatic.net/ajax/libs/vue/3.3.7/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
<link rel="preconnect" href="https://fonts.loli.net" />
<link rel="preconnect" href="https://gstatic.loli.net" crossorigin />
<link rel="stylesheet" href="https://fonts.loli.net/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap" />
<script> const mixins = {}; </script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>


<script src="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
<link
    rel="stylesheet"
    href="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>



<script src="/js/lib/preview.js"></script>









<link rel="stylesheet" href="/css/main.css" />

<meta name="generator" content="Hexo 6.3.0"></head>
<body>
    <div id="layout">
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>加载过慢请开启缓存 浏览器默认开启</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
        </transition>
        <div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <nav id="desktop-menu">
        <a class="title" href="/">
            <span>LUCKYY-CODE</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </nav>
    <nav id="mobile-menu">
        <div class="title" @click="showMenuItems = !showMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;LUCKYY-CODE</span>
        </div>
        <transition name="slide">
            <div class="items" v-show="showMenuItems">
                
                <a href="/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-house fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                    </div>
                </a>
                
                <a href="/about">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-id-card fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                    </div>
                </a>
                
                <a href="/archives">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-box-archive fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                    </div>
                </a>
                
                <a href="/categories">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-bookmark fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                    </div>
                </a>
                
                <a href="/tags">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-tags fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                    </div>
                </a>
                
            </div>
        </transition>
    </nav>
</div>
<transition name="fade">
    <div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div>
</transition>

        <div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'">
            <div class="article">
    <div>
        <h1>star二 登录&amp;新增员工&amp;员工列表功能</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/4/19
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <i class="fa-solid fa-tags fa-fw"></i>
            </span>
            
            
            <span class="tag">
                
                <a href="/tags/java/" style="color: #ff7d73">java</a>
            </span>
            
            <span class="tag">
                
                <a href="/tags/star/" style="color: #03a9f4">star</a>
            </span>
            
        </span>
        
    </div>
    
    <div class="content" v-pre>
        <h3 id="star二-登录-新增员工-员工列表功能"><a href="#star二-登录-新增员工-员工列表功能" class="headerlink" title="star二 登录&amp;新增员工&amp;员工列表功能"></a>star二 登录&amp;新增员工&amp;员工列表功能</h3><span id="more"></span>

<h2 id="1-登录功能"><a href="#1-登录功能" class="headerlink" title="1.登录功能"></a>1.登录功能</h2><p><strong>1.Controller层</strong></p>
<p>在sky-server模块中，com.sky.controller.admin.EmployeeController</p>
<pre><code class="java">/**
     * 登录
     *
     * @param employeeLoginDTO
     * @return
     */
    @PostMapping(&quot;/login&quot;)
    public Result&lt;EmployeeLoginVO&gt; login(@RequestBody EmployeeLoginDTO employeeLoginDTO) &#123;
        log.info(&quot;员工登录：&#123;&#125;&quot;, employeeLoginDTO);
        //调用service方法查询数据库
        Employee employee = employeeService.login(employeeLoginDTO);

        //登录成功后，生成jwt令牌
        Map&lt;String, Object&gt; claims = new HashMap&lt;&gt;();
        claims.put(JwtClaimsConstant.EMP_ID, employee.getId());
        String token = JwtUtil.createJWT(
                jwtProperties.getAdminSecretKey(),
                jwtProperties.getAdminTtl(),
                claims);

        EmployeeLoginVO employeeLoginVO = EmployeeLoginVO.builder()
                .id(employee.getId())
                .userName(employee.getUsername())
                .name(employee.getName())
                .token(token)
                .build();

        return Result.success(employeeLoginVO);
    &#125;
</code></pre>
<p><strong>2.Service层</strong></p>
<p>在sky-server模块中，com.sky.service.impl.EmployeeServiceImpl</p>
<pre><code class="java">/**
     * 员工登录
     *
     * @param employeeLoginDTO
     * @return
     */
    public Employee login(EmployeeLoginDTO employeeLoginDTO) &#123;
        String username = employeeLoginDTO.getUsername();
        String password = employeeLoginDTO.getPassword();

        //1、根据用户名查询数据库中的数据
        Employee employee = employeeMapper.getByUsername(username);

        //2、处理各种异常情况（用户名不存在、密码不对、账号被锁定）
        if (employee == null) &#123;
            //账号不存在
            throw new AccountNotFoundException(MessageConstant.ACCOUNT_NOT_FOUND);
        &#125;

        //密码比对
        if (!password.equals(employee.getPassword())) &#123;
            //密码错误
            throw new PasswordErrorException(MessageConstant.PASSWORD_ERROR);
        &#125;

        if (employee.getStatus() == StatusConstant.DISABLE) &#123;
            //账号被锁定
            throw new AccountLockedException(MessageConstant.ACCOUNT_LOCKED);
        &#125;

        //3、返回实体对象
        return employee;
    &#125;
</code></pre>
<p><strong>3.Mapper层</strong></p>
<p>在sky-server模块中，com.sky.mapper.EmployeeMapper</p>
<pre><code class="java">package com.sky.mapper;

import com.sky.entity.Employee;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Select;

@Mapper
public interface EmployeeMapper &#123;

    /**
     * 根据用户名查询员工
     * @param username
     * @return
     */
    @Select(&quot;select * from employee where username = #&#123;username&#125;&quot;)
    Employee getByUsername(String username);

&#125;
</code></pre>
<h3 id="2-完善登录功能"><a href="#2-完善登录功能" class="headerlink" title="2.完善登录功能"></a>2.完善登录功能</h3><p><strong>问题：</strong>员工表中的密码是明文存储，安全性太低。</p>
<p><img src="/home/feng/Documents/sky-take-out/%E8%AE%B2%E4%B9%89/day01/assets/image-20221107160529803.png" alt="image-20221107160529803"></p>
<p><strong>解决思路：</strong></p>
<ol>
<li><p>将密码加密后存储，提高安全性</p>
<img src="/home/feng/Documents/sky-take-out/讲义/day01/assets/image-20221107161918913.png" alt="image-20221107161918913" style="zoom:50%;" />
</li>
<li><p>使用MD5加密方式对明文密码加密</p>
<img src="/home/feng/Documents/sky-take-out/讲义/day01/assets/image-20221107160739680.png" alt="image-20221107160739680" style="zoom:50%;" /></li>
</ol>
<p><strong>实现步骤：</strong></p>
<ol>
<li><p>修改数据库中明文密码，改为MD5加密后的密文</p>
<p>打开employee表，修改密码</p>
<p><img src="/home/feng/Documents/sky-take-out/%E8%AE%B2%E4%B9%89/day01/assets/image-20221107161446710.png" alt="image-20221107161446710"></p>
</li>
<li><p>修改Java代码，前端提交的密码进行MD5加密后再跟数据库中密码比对</p>
<p>打开EmployeeServiceImpl.java，修改比对密码</p>
<pre><code class="java">/**
     * 员工登录
     *
     * @param employeeLoginDTO
     * @return
     */
    public Employee login(EmployeeLoginDTO employeeLoginDTO) &#123;

        //1、根据用户名查询数据库中的数据
       
        //2、处理各种异常情况（用户名不存在、密码不对、账号被锁定）
        //.......
        //密码比对
        // TODO 后期需要进行md5加密，然后再进行比对
        password = DigestUtils.md5DigestAsHex(password.getBytes());
        if (!password.equals(employee.getPassword())) &#123;
            //密码错误
            throw new PasswordErrorException(MessageConstant.PASSWORD_ERROR);
        &#125;

        //........

        //3、返回实体对象
        return employee;
    &#125;
</code></pre>
</li>
</ol>
<h3 id="3-knife4j使用步骤"><a href="#3-knife4j使用步骤" class="headerlink" title="3.knife4j使用步骤"></a>3.knife4j使用步骤</h3><ol>
<li><p>导入 knife4j 的maven坐标</p>
<p>在pom.xml中添加依赖</p>
<pre><code class="xml">&lt;dependency&gt;
   &lt;groupId&gt;com.github.xiaoymin&lt;/groupId&gt;
   &lt;artifactId&gt;knife4j-spring-boot-starter&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
</li>
<li><p>在配置类中加入 knife4j 相关配置</p>
<p>WebMvcConfiguration.java</p>
<pre><code class="java">/**
     * 通过knife4j生成接口文档
     * @return
*/
    @Bean
    public Docket docket() &#123;
        ApiInfo apiInfo = new ApiInfoBuilder()
                .title(&quot;星辰送餐目接口文档&quot;)
                .version(&quot;2.0&quot;)
                .description(&quot;星辰送餐项目接口文档&quot;)
                .build();
        Docket docket = new Docket(DocumentationType.SWAGGER_2)
                .apiInfo(apiInfo)
                .select()
                .apis(RequestHandlerSelectors.basePackage(&quot;com.sky.controller&quot;))
                .paths(PathSelectors.any())
                .build();
        return docket;
    &#125;
</code></pre>
</li>
<li><p>设置静态资源映射，否则接口文档页面无法访问</p>
<p>WebMvcConfiguration.java</p>
<pre><code class="java">/**
     * 设置静态资源映射
     * @param registry
*/
protected void addResourceHandlers(ResourceHandlerRegistry registry) &#123;
        registry.addResourceHandler(&quot;/doc.html&quot;).addResourceLocations(&quot;classpath:/META-INF/resources/&quot;);
        registry.addResourceHandler(&quot;/webjars/**&quot;).addResourceLocations(&quot;classpath:/META-INF/resources/webjars/&quot;);
&#125;
</code></pre>
</li>
</ol>
<h3 id="常用注解"><a href="#常用注解" class="headerlink" title="常用注解"></a>常用注解</h3><p>通过注解可以控制生成的接口文档，使接口文档拥有更好的可读性，常用注解如下：</p>
<table>
<thead>
<tr>
<th><strong>注解</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>@Api</td>
<td>用在类上，例如Controller，表示对类的说明</td>
</tr>
<tr>
<td>@ApiModel</td>
<td>用在类上，例如entity、DTO、VO</td>
</tr>
<tr>
<td>@ApiModelProperty</td>
<td>用在属性上，描述属性信息</td>
</tr>
<tr>
<td>@ApiOperation</td>
<td>用在方法上，例如Controller的方法，说明方法的用途、作用</td>
</tr>
</tbody></table>
<h2 id="5-新增员工"><a href="#5-新增员工" class="headerlink" title="5.新增员工"></a>5.新增员工</h2><h4 id="Controller层"><a href="#Controller层" class="headerlink" title="Controller层"></a>Controller层</h4><p> <strong>EmployeeController中创建新增员工方法</strong></p>
<p>进入到sky-server模块中，在com.sky.controller.admin包下，在EmployeeController中创建新增员工方法，接收前端提交的参数。</p>
<pre><code class="java">    /**
     * 新增员工
     * @param employeeDTO
     * @return
     */
    @PostMapping
    @ApiOperation(&quot;新增员工&quot;)
    public Result save(@RequestBody EmployeeDTO employeeDTO)&#123;
        log.info(&quot;新增员工：&#123;&#125;&quot;,employeeDTO);
        employeeService.save(employeeDTO);//该方法后续步骤会定义
        return Result.success();
    &#125;
</code></pre>
<p><strong>注：</strong>Result类定义了后端统一返回结果格式。</p>
<p>进入sky-common模块，在com.sky.result包下定义了Result.java</p>
<pre><code class="java">package com.sky.result;

import lombok.Data;

import java.io.Serializable;

/**
 * 后端统一返回结果
 * @param &lt;T&gt;
 */
@Data
public class Result&lt;T&gt; implements Serializable &#123;

    private Integer code; //编码：1成功，0和其它数字为失败
    private String msg; //错误信息
    private T data; //数据

    public static &lt;T&gt; Result&lt;T&gt; success() &#123;
        Result&lt;T&gt; result = new Result&lt;T&gt;();
        result.code = 1;
        return result;
    &#125;

    public static &lt;T&gt; Result&lt;T&gt; success(T object) &#123;
        Result&lt;T&gt; result = new Result&lt;T&gt;();
        result.data = object;
        result.code = 1;
        return result;
    &#125;

    public static &lt;T&gt; Result&lt;T&gt; error(String msg) &#123;
        Result result = new Result();
        result.msg = msg;
        result.code = 0;
        return result;
    &#125;

&#125;
</code></pre>
<h4 id="1-2-3-Service层接口"><a href="#1-2-3-Service层接口" class="headerlink" title="1.2.3 Service层接口"></a>1.2.3 Service层接口</h4><p><strong>在EmployeeService接口中声明新增员工方法</strong></p>
<p>进入到sky-server模块中,com.sky.server.EmployeeService</p>
<pre><code class="java">    /**
     * 新增员工
     * @param employeeDTO
     */
    void save(EmployeeDTO employeeDTO);
</code></pre>
<h4 id="1-2-4-Service层实现类"><a href="#1-2-4-Service层实现类" class="headerlink" title="1.2.4 Service层实现类"></a>1.2.4 Service层实现类</h4><p><strong>在EmployeeServiceImpl中实现新增员工方法</strong></p>
<p>com.sky.server.impl.EmployeeServiceImpl中创建方法</p>
<pre><code class="java">    /**
     * 新增员工
     *
     * @param employeeDTO
     */
    public void save(EmployeeDTO employeeDTO) &#123;
        Employee employee = new Employee();

        //对象属性拷贝
        BeanUtils.copyProperties(employeeDTO, employee);

        //设置账号的状态，默认正常状态 1表示正常 0表示锁定
        employee.setStatus(StatusConstant.ENABLE);

        //设置密码，默认密码123456
        employee.setPassword(DigestUtils.md5DigestAsHex(PasswordConstant.DEFAULT_PASSWORD.getBytes()));

        //设置当前记录的创建时间和修改时间
        employee.setCreateTime(LocalDateTime.now());
        employee.setUpdateTime(LocalDateTime.now());

        //设置当前记录创建人id和修改人id
        employee.setCreateUser(10L);//目前写个假数据，后期修改
        employee.setUpdateUser(10L);

        employeeMapper.insert(employee);//后续步骤定义
    &#125;
</code></pre>
<p>在sky-common模块com.sky.constants包下已定义StatusConstant.java</p>
<pre><code class="java">package com.sky.constant;

/**
 * 状态常量，启用或者禁用
 */
public class StatusConstant &#123;

    //启用
    public static final Integer ENABLE = 1;

    //禁用
    public static final Integer DISABLE = 0;
&#125;
</code></pre>
<h4 id="1-2-5-Mapper层"><a href="#1-2-5-Mapper层" class="headerlink" title="1.2.5 Mapper层"></a>1.2.5 Mapper层</h4><p><strong>在EmployeeMapper中声明insert方法</strong></p>
<p>com.sky.EmployeeMapper中添加方法</p>
<pre><code class="java">    /**
     * 插入员工数据
     * @param employee
     */
    @Insert(&quot;insert into employee (name, username, password, phone, sex, id_number, create_time, update_time, create_user, update_user,status) &quot; +
            &quot;values &quot; +
            &quot;(#&#123;name&#125;,#&#123;username&#125;,#&#123;password&#125;,#&#123;phone&#125;,#&#123;sex&#125;,#&#123;idNumber&#125;,#&#123;createTime&#125;,#&#123;updateTime&#125;,#&#123;createUser&#125;,#&#123;updateUser&#125;,#&#123;status&#125;)&quot;)
    void insert(Employee employee);
</code></pre>
<p>在application.yml中已开启驼峰命名，故id_number和idNumber可对应。</p>
<pre><code class="yaml">mybatis:
  configuration:
    #开启驼峰命名
    map-underscore-to-camel-case: true
</code></pre>
<h2 id="6-员分页查询"><a href="#6-员分页查询" class="headerlink" title="6.员分页查询"></a>6.员分页查询</h2>
    </div>
    
    
    
    
    
    
    
</div>

            <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2024 luckyy-code
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;段雨超
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

        </div>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>

    <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas>
    <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script>
    <script type="text/javascript" src="/js/fireworks.js"></script>

    <script src="/js/main.js"></script>
    <script src="/js/lib/fireworks.js>"></script>

    
    




    
</body>
</html>
